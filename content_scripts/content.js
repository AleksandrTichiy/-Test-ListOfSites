function get_host_info(){for(var e,n=document.location.hostname.split("."),i="tldfind="+(new Date).getTime(),o=[];e=n.pop();)if(o.unshift(e),document.cookie=i+";domain=."+o.join(".")+";",document.cookie.indexOf(i)>-1){document.cookie=i+";domain=."+o.join(".")+";expires=Thu, 01 Jan 1970 00:00:01 GMT;";break}return{subdomain:n.join(".")||null,domain:o.join(".")||null,tld:o.slice(1).join(".")||null}}var info=get_host_info(),currentDomain=info.domain;chrome.runtime.sendMessage({greeting:"Get domens"},function(e){var n=JSON.parse(e.data);for(index=0;index<n.length;++index)if(n[index].domain==currentDomain){if(location.href.indexOf("search")+1){var i={icon:"http://files.softicons.com/download/android-icons/maximal-circle-icons-by-fritz-franke/png/128x128/chrome.png"};switch(currentDomain){case"google.com":case"google.ru":o=$("._Rm");$.each(o,function(e,o){$.each(n,function(n,t){if(o.innerHTML.indexOf(t.domain)+1){var a=$("._Rm:eq("+e+")").parents("div.rc"),s='<img src="{{icon}}" class="templateIcon" alt="Template icon" />'+a.html();s=Handlebars.compile(s),a.html(s(i))}})});break;case"bing.com":var o=$(".b_attribution cite");console.log(o),$.each(o,function(e,o){$.each(n,function(n,t){if(o.innerText.indexOf(t.domain)+1){console.log(o.innerText+" - "+t.domain);var a=$(".b_attribution cite:eq("+e+")").parents(".b_algo"),s='<img src="{{icon}}" class="templateIcon" alt="Template icon" width="64px" height="64px" />'+a.html();s=Handlebars.compile(s),a.html(""),a.append(s(i))}})})}}chrome.runtime.sendMessage({greeting:"Get Data",cd:currentDomain},function(e){var i=JSON.parse(e.data);if(null!=i&&("true"==i[0]||i[1]>=3))return!1;var o="<div class='messageWrapList' id='messageWrapList'><div class='messageList'><div class='entry'><h3>"+n[index].message.replace(" %"," {{").replace("%!","}}!")+"</h3></div><div class='messageCloseList' id='RW759_connectExtension'><span>Закрыть</span></div></div></div>",t=chrome.extension.connect({name:"Communication 1"});t.postMessage("Hi BackGround"),t.onMessage.addListener(function(e){if(o=Handlebars.compile(o),e)n={username:e};else var n={username:"гость"};var i=document.createElement("div");i.className="messageWrapList",i.id="messageWrapList",i.innerHTML=o(n),document.body.insertBefore(i,document.body.lastChild),chrome.runtime.sendMessage({greeting:"Set visits count",cd:currentDomain,cu:location.href},function(e){}),document.getElementById("RW759_connectExtension").onclick=function(){document.getElementById("messageWrapList").setAttribute("style","display:none"),chrome.runtime.sendMessage({greeting:"hello",cd:currentDomain,cu:location.href},function(e){})}})});break}});
